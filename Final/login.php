<!DOCTYPE html>
<head>
  <title> Login page in action</title>
  <script>
    function validateForm(){
      var value = document.forms["form"]["user"].value;
      var value3 =document.forms["form"]["password"].value;

      var fail = "";
      fail = this.validateUserName(value);
      fail += this.validateUserPassword(value3);

      if(fail == "") return true;
      else {
            alert(fail);
            return false;
          }
    }

    function validateUserName(name){
      if(name == "") return " JS - user name not found \n";
      else if(name.length <5){
        return "JS- name too short, must be atleast 5 chars long \n";
      }else if (/[^a-zA-Z0-9_-]/.test(name))
        return "JS- invalid user name characters \n";
      return "";

      // return "hs- name error"
    }

    function validateUserPassword(password){
      if(password == "")
        return "JS- password not found \n";
      else if(password.length < 6)
        return "JS- password must be atleast 6 chars long \n";
      else if(!(/[a_z]/.test(password)) ||
                !(/[A-Z]/.test(password)) ||
                !(/[0-9]/.test(password)))
        return "JS- password must contain caps, small and number \n";
      else
        return "";
      // return "JS- password error";
    }

  </script>
</head>
<body>


<form name ="form" action="loginPage.php" onsubmit="return validateForm()" method ="post" id ="form" >
Username: <input type="text" maxlength="32" name="user" id = "user" ><br>
Password: <input type="password" maxlength="32" name="password" id = "password" ><br>

<input type ="submit" value ="Login" />
</form>

</body>
</html>

<?php
$username = $password ="";

if(isset($_POST['user']))
  $username = fix_string($_POST['user']);

if(isset($_POST['password']))
  $password =fix_string($_POST['password']);

function fix_string($string){
  if (get_magic_quotes_gpc()) $string = stripslashes($string);
  return htmlentities($string);
}

function validate_username($string){
  //check if empty
  if($string == "") return "php- username not inserted <br />";
  else if(strlen($string) < 5)
    return "php- username must be 5char long <br />";
  //The username can contain English letters (capitalized or not), digits, and the charaters '_' (underscore) and '-' (dash). Nothing else.
  else if(preg_match("/[^a-zA-Z0-9_-]/", $string))
    return "php- illegal chars found <br />";
    return "";
}

function validate_pass($string){
  if($string =="") return "php- Password not found <br />";
  else if(strlen($string) < 6)
    return "php- passwords must be atleast 6 chars long <br />";
  else if(!preg_match("/[a-z]/",$string) || !preg_match("/[A-Z]/",$string) || !preg_match("/[0-9]/",$string))
    return "php- Password must contain capital letters, small letters and numbers <br />";
  return "";
}

//backend validation
$fail = "";
$fail = validate_username($username);
$fail .= validate_pass($password);

if(isset($_POST['user'])){
  if($fail == ""){
    echo "</html><body>
    php- Form data successfully validated: $username, $password.
    </body> </html>";
  }else{
    echo $fail;
  }
}
?>
